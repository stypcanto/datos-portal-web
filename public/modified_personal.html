<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Personal CENATE</title>
    <link rel="stylesheet" href="./css/style2.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
      .hidden {
        display: none;
      }

      .required::after {
        content: " *";
        color: red;
      }
    </style>
  </head>
  <body>
    <!-- Logos en la parte superior -->
    <header class="header">
      <div class="logo-left">
        <img src="img/LOGO ESSALUD.png" alt="Logo Izquierdo">
      </div>
      <div class="logo-right">
        <img src="img/LOGO CENATE.png" alt="Logo Derecho">
      </div>
    </header>

    <div class="container">
      <h1 class="titulo">Registro de Personal CENATE</h1>
      
      <!-- Formulario para buscar por DNI -->
      <div class="form-container" id="search-form">
        <h2>Ingrese el número de DNI</h2>
        <div class="row">
          <div class="col-md-4">
            <label for="search-dni">DNI:</label>
            <input type="text" id="search-dni" class="form-control" required placeholder="Ingrese el DNI a buscar">
          </div>
        </div>
        <div class="btn-container">
          <button class="btn" onclick="fetchDataByDni()">Buscar</button>
          <button class="btn" onclick="showAddForm()">Agregar Registro</button>
          <button class="btn" onclick="goToDirectory()">Regresar al Directorio</button>
        </div>
      </div>

      <!-- Formulario para agregar un nuevo registro -->
      <div class="form-container hidden" id="add-form">
        <h2>Agregar Nuevo Registro</h2>
        <form id="add-form-fields">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="dni" class="form-label required">DNI</label>
                <input
                  type="text"
                  class="form-control"
                  id="dni"
                  placeholder="Ingrese el número de DNI"
                  pattern="^\d{8}$"
                  maxlength="8"
                  required
                  oninput="validateDNI(this)" />
              </div>
            </div>
            
            <script>
              function validateDNI(input) {
                const dni = input.value;
                const regex = /^\d{8}$/;
            
                // Solo muestra el mensaje si el DNI es incorrecto y tiene exactamente 8 dígitos
                if (dni && !regex.test(dni)) {
                  input.setCustomValidity("El DNI debe tener 8 dígitos.");
                } else {
                  input.setCustomValidity("");
                }
              }
            </script>
            <div class="col-md-4">
              <label for="nombre" class="required">Nombre:</label>
              <input type="text" id="nombre" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label for="apellido" class="required">Apellido:</label>
              <input type="text" id="apellido" class="form-control" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="fechanacimiento" class="required">Fecha de Nacimiento:</label>
              <input type="date" id="fechanacimiento" class="form-control" required>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="telefono" class="form-label required">Teléfono</label>
                <input
                  type="text"
                  class="form-control"
                  id="telefono"
                  placeholder="Ingrese el número de celular"
                  pattern="^\d{9}$"
                  maxlength="9"
                  required
                  oninput="validateTelefono(this)" />
              </div>
            </div>
            
            <script>
              function validateTelefono(input) {
                const telefono = input.value;
                const regex = /^\d{9}$/;
            
                // Solo muestra el mensaje si el teléfono es incorrecto y tiene exactamente 9 dígitos
                if (telefono && !regex.test(telefono)) {
                  input.setCustomValidity("El teléfono debe tener 9 dígitos.");
                } else {
                  input.setCustomValidity("");
                }
              }
            </script>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="correo" class="form-label required">Correo electrónico</label>
                <input
                  type="email"
                  class="form-control"
                  id="correo"
                  placeholder="Ingrese el correo personal"
                  required
                  pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                  title="Por favor, ingrese un correo electrónico válido" />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="direccion" class="required">Dirección:</label>
              <input type="text" id="direccion" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label for="genero" class="form-label required">Género</label>
              <select id="genero" class="form-control custom-select" required>
                <option value="" disabled selected>Selecciona una opción</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="colegiatura" class="required">Colegiatura:</label>
              <input type="text" id="colegiatura" class="form-control" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="rnp" class="required">RNP:</label>
              <input type="text" id="rnp" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label for="profesion" class="required">Profesión:</label>
              <select id="profesion" class="form-control" required>
                <option value="" disabled selected>Seleccione una profesión</option>
                <!-- Options for profession -->
                <option value="Médico">Médico</option>
                <option value="Enfermero/a">Enfermero/a</option>
                <option value="Técnico de Radiología">Técnico de Radiología</option>
                <option value="Farmacéutico/a">Farmacéutico/a</option>
                <option value="Técnico de Laboratorio">Técnico de Laboratorio</option>
                <option value="Nutricionista">Nutricionista</option>
                <option value="Psicólogo/a">Psicólogo/a</option>
                <option value="Terapeuta Ocupacional">Terapeuta Ocupacional</option>
                <option value="Fisioterapeuta">Fisioterapeuta</option>
                <option value="Técnico en Emergencias Médicas">Técnico en Emergencias Médicas</option>
                <option value="Odontólogo/a">Odontólogo/a</option>
              </select>
            </div>
            
            <div class="col-md-4">
              <label for="especialidad" class="required">Especialidad:</label>
              <select id="especialidad" class="form-control" required>
                <option value="" disabled selected>Seleccione una especialidad</option>
                <!-- Options for specialties -->
                <option value="Anestesiología">Anestesiología</option>
                <option value="Cardiología">Cardiología</option>
                <option value="Cirugía General">Cirugía General</option>
                <option value="Dermatología">Dermatología</option>
                <option value="Endocrinología">Endocrinología</option>
              </select>
            </div>
            
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="fechaingresolaboral" class="required">Fecha Ingreso Laboral:</label>
              <input type="date" id="fechaingresolaboral" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label for="fechaterminolaboral">Fecha Terminación Laboral:</label>
              <input type="date" id="fechaterminolaboral" class="form-control">
            </div>
            <div class="col-md-4">
              <label for="activo" class="required">Activo:</label>
              <select id="activo" class="form-control custom-select" required>
                <option value="S" selected>Sí</option>
                <option value="N">No</option>
              </select>
            </div>
          </div>
          <button type="button" class="btn" onclick="addPerson()">Guardar Registro</button>
          <button type="button" class="btn" onclick="clearForm()">Limpiar Formulario</button>
          <button type="button" class="btn" onclick="goBack()">Cerrar el nuevo registro</button>
        </form>
      </div>

      <!-- Contenedor para mostrar la lista de registros -->
      <div id="listContainer"></div>
    </div>

    <script>
      // Función para mostrar el formulario de agregar registro
      function showAddForm() {
        document.getElementById('add-form').classList.remove('hidden');
      }

      // Función para ocultar el formulario de agregar registro
      function hideAddForm() {
        document.getElementById('add-form').classList.add('hidden');
      }

      // Función para convertir la fecha a formato 'DD/MM/YYYY'
      function formatDate(date) {
        const d = new Date(date);
        const day = ("0" + d.getDate()).slice(-2);
        const month = ("0" + (d.getMonth() + 1)).slice(-2);
        const year = d.getFullYear();
        return `${day}/${month}/${year}`;
      }

  

      function validateTelefono(input) {
    const telefono = input.value;
    const regex = /^\d{9}$/;

    // Solo muestra el mensaje si el teléfono es incorrecto y tiene exactamente 9 dígitos
    if (telefono && !regex.test(telefono)) {
      input.setCustomValidity("El teléfono debe tener 9 dígitos.");
    } else {
      input.setCustomValidity("");
    }
  }
      
      // Funciones para manejar el formulario
   


      function addPerson() {
    const dni = document.getElementById('dni').value.trim();
    const nombre = document.getElementById('nombre').value.trim();
    const apellido = document.getElementById('apellido').value.trim();
    const fechanacimiento = document.getElementById('fechanacimiento').value || null; // Formato YYYY-MM-DD
    const telefono = document.getElementById('telefono').value.trim();
    const correo = document.getElementById('correo').value.trim();
    const direccion = document.getElementById('direccion').value.trim();
    const genero = document.getElementById('genero').value;
    const colegiatura = document.getElementById('colegiatura').value.trim();
    const rnp = document.getElementById('rnp').value.trim();
    const profesion = document.getElementById('profesion').value;
    const especialidad = document.getElementById('especialidad').value;
    const fechaingresolaboral = document.getElementById('fechaingresolaboral').value || null; // Formato YYYY-MM-DD
    const fechaterminolaboral = document.getElementById('fechaterminolaboral').value || null; // Null si está vacío
    const activo = document.getElementById('activo').value;

    // Validar campos requeridos
    if (!dni || !nombre || !apellido || !fechanacimiento || !telefono || !correo || !direccion || !genero || !colegiatura || !rnp || !profesion || !especialidad || !fechaingresolaboral || !activo) {
      alert('Por favor, complete todos los campos obligatorios.');
      return;
    }

    // Formato del nuevo registro
    const nuevoRegistro = {
      dni,
      nombre,
      apellido,
      fechanacimiento,
      telefono,
      correo,
      direccion,
      genero,
      colegiatura,
      rnp,
      profesion,
      especialidad,
      fechaingresolaboral,
      fechaterminolaboral, // Se envía como null si está vacío
      activo,
    };

    // Realizar solicitud POST
    fetch('http://localhost:3000/personal_cenate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(nuevoRegistro),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        if (data.message) {
          alert(data.message);
          clearForm(); // Limpiar el formulario después de guardar
          hideAddForm(); // Ocultar formulario de registro
        } else {
          alert('Error al guardar el registro. Verifique los datos ingresados.');
        }
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('Hubo un error al enviar la solicitud. Intente nuevamente.');
      });
  }





      function clearForm() {
        document.getElementById('add-form-fields').reset();
      }

      function goBack() {
        hideAddForm();
      }
      
      function goToDirectory() {
        window.location.href = 'personal_cenate.html'; // Cambia 'personal_cenate.html' al nombre de tu página de personal_cenate
      }

      

        // Aquí va la lógica para obtener datos del backend o de una base de datos según el DNI ingresado
        // Luego de obtener la información, se puede mostrar de manera dinámica en la página
      

        function fetchDataByDni() {
  const dni = document.getElementById('search-dni').value;

  if (dni === "") {
    alert("Por favor ingresa un número de DNI.");
    return;
  }

  // Realiza la solicitud al servidor
  fetch(`http://localhost:3000/personal_cenate/${dni}`, {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data) {
      // Aquí puedes mostrar los datos en tu página
      // Podrías actualizar el HTML con la información que se recibe
      alert(`Datos encontrados: ${JSON.stringify(data)}`);
    } else {
      alert("No se encontró ningún registro.");
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert("Hubo un error al buscar los datos.");
  });
}

    </script>
  </body>
</html>
