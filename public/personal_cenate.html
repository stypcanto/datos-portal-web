<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Personal CENATE</title>
    <link rel="stylesheet" href="./css/style2.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  </head>
  <body>
    <!-- Logos en la parte superior -->
    <header class="header">
      <div class="logo-left">
        <img src="img/LOGO ESSALUD.png" alt="Logo Izquierdo">
      </div>
      <div class="logo-right">
        <img src="img/LOGO CENATE.png" alt="Logo Derecho">
      </div>
     
    </header>

    <div class="container">
      <h1 class="titulo">Personal de CENATE</h1>
      
      <!-- Spinner de carga -->
      <div class="text-center mb-3" id="loading-spinner">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>
      
      <!-- Tabla de Datos -->
      <div class="table-container">
        <table id="data-table" class="table table-bordered table-striped">
          <thead>
            <tr></tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="10">Cargando datos...</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Botón para exportar a Excel -->
      <button id="export-btn" class="btn">Exportar a Excel</button>

       <!-- Botón para editar -->
       <button id="editar-btn" class="btn">Editar Datos</button>
    </div>

    <script>
      let allData = [];

      async function fetchData() {
        const spinner = document.getElementById("loading-spinner");
        const tbody = document.querySelector("#data-table tbody");

        spinner.style.display = "block";

        try {
          const response = await fetch("/personal_cenate");
          if (!response.ok) {
            throw new Error(`Error en la solicitud: ${response.statusText}`);
          }

          const data = await response.json();

          if (Array.isArray(data.columns) && Array.isArray(data.rows)) {
            allData = data.rows;
            const thead = document.querySelector("#data-table thead");
            thead.innerHTML = `<tr>${data.columns.map(col => `<th>${col}</th>`).join("")}</tr>`;

            tbody.innerHTML = data.rows
              .map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join("")}</tr>`)
              .join("");
          } else {
            throw new Error("Formato de datos inesperado.");
          }
        } catch (error) {
          console.error("Error al obtener los datos:", error);
          tbody.innerHTML = "<tr><td colspan='10'>Error al cargar los datos</td></tr>";
        } finally {
          spinner.style.display = "none";
        }
      }


 // Función para redirigir a la página de edición
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("editar-btn").addEventListener("click", () => {
         window.location.href = "/modified_personal_cenate.html";
       });
  });


      document.getElementById("export-btn").addEventListener("click", () => {
        const wb = XLSX.utils.book_new();
        const table = document.getElementById("data-table");
        const ws = XLSX.utils.table_to_sheet(table);

        XLSX.utils.book_append_sheet(wb, ws, "Datos");
        XLSX.writeFile(wb, "personal_cenate.xlsx");
      });

      fetchData();
    </script>
  </body>
</html>
